{% extends 'base.html' %}
{% load static %}

{% block page_title %}Welcome Back, {{ user.first_name|default:user.username }}{% endblock %}
{% block page_subtitle %}Continue your sign language journey today.{% endblock %}

{% block header_content %}
<div class="flex flex-col">
    <h1 class="text-3xl font-bold text-white tracking-tight">Welcome Back, {{ user.first_name|default:user.username }}
    </h1>
    <p class="text-slate-400 text-sm mt-1">Continue your sign language journey today.</p>
</div>
{% endblock %}

{% block content %}
<!-- Quick Actions Grid -->
<section class="grid grid-cols-1 md:grid-cols-3 gap-6">
    <!-- Card 1: Upload -->
    <a href="{% url 'upload' %}"
        class="glass-panel p-6 rounded-2xl glass-card-hover cursor-pointer transition-all duration-300 group block">
        <div class="flex justify-between items-start mb-4">
            <div
                class="w-12 h-12 rounded-xl bg-primary/20 flex items-center justify-center text-primary group-hover:bg-primary group-hover:text-white transition-colors duration-300">
                <span class="material-icons-round text-2xl">cloud_upload</span>
            </div>
            <span
                class="material-icons-round text-slate-500 group-hover:text-white transition-colors">arrow_forward</span>
        </div>
        <h3 class="text-lg font-semibold text-white mb-1">Upload PPT</h3>
        <p class="text-sm text-slate-400">Convert your slides into sign language avatar animations instantly.</p>
    </a>

    <!-- Card 2: Live Converter (Replaced 'Start Quiz' with relevant link if quiz not main focus, or keep quiz) -->
    <!-- Assuming Quiz is a feature based on layout, linking to quiz or animation -->
    <a href="{% url 'animation' %}"
        class="glass-panel p-6 rounded-2xl glass-card-hover cursor-pointer transition-all duration-300 group block">
        <div class="flex justify-between items-start mb-4">
            <div
                class="w-12 h-12 rounded-xl bg-purple-500/20 flex items-center justify-center text-purple-400 group-hover:bg-purple-500 group-hover:text-white transition-colors duration-300">
                <span class="material-icons-round text-2xl">psychology</span>
            </div>
            <span
                class="material-icons-round text-slate-500 group-hover:text-white transition-colors">arrow_forward</span>
        </div>
        <h3 class="text-lg font-semibold text-white mb-1">Start Quiz</h3>
        <p class="text-sm text-slate-400">Test your vocabulary retention with AI-generated questions.</p>
    </a>

    <!-- Card 3: History/Library -->
    <a href="{% url 'history' %}"
        class="glass-panel p-6 rounded-2xl glass-card-hover cursor-pointer transition-all duration-300 group block">
        <div class="flex justify-between items-start mb-4">
            <div
                class="w-12 h-12 rounded-xl bg-emerald-500/20 flex items-center justify-center text-emerald-400 group-hover:bg-emerald-500 group-hover:text-white transition-colors duration-300">
                <span class="material-icons-round text-2xl">history</span>
            </div>
            <span
                class="material-icons-round text-slate-500 group-hover:text-white transition-colors">arrow_forward</span>
        </div>
        <h3 class="text-lg font-semibold text-white mb-1">View History</h3>
        <p class="text-sm text-slate-400">Review your past conversions and learning progress.</p>
    </a>
</section>

<!-- Recent Uploads Table Section -->
<section>
    <div class="flex items-center justify-between mb-6">
        <h2 class="text-xl font-semibold text-white">Recent Uploads</h2>
        <!-- <a href="#" class="text-sm text-primary hover:text-primary/80 font-medium flex items-center">
            View All <span class="material-icons-round text-base ml-1">chevron_right</span>
        </a> -->
    </div>
    <div class="glass-panel rounded-2xl overflow-hidden">
        <div class="overflow-x-auto">
            <table class="w-full text-left text-sm">
                <thead>
                    <tr class="text-slate-400 border-b border-white/5">
                        <th class="px-6 py-4 font-medium">File Name</th>
                        <th class="px-6 py-4 font-medium">Date Uploaded</th>
                        <!-- <th class="px-6 py-4 font-medium">Size</th> --> <!-- Model doesn't have size yet -->
                        <th class="px-6 py-4 font-medium">Status</th>
                        <th class="px-6 py-4 font-medium text-right">Action</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-white/5">
                    {% for upload in uploads %}
                    <tr class="hover:bg-white/5 transition-colors group">
                        <td class="px-6 py-4">
                            <div class="flex items-center">
                                <div
                                    class="w-8 h-8 rounded bg-orange-500/20 text-orange-400 flex items-center justify-center mr-3">
                                    <span class="material-icons-round text-lg">description</span>
                                </div>
                                <div>
                                    <p class="text-white font-medium">{{ upload.title }}</p>
                                    <p class="text-xs text-slate-500">PPTX Presentation</p>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-4 text-slate-400">{{ upload.uploaded_at|timesince }} ago</td>
                        <!-- <td class="px-6 py-4 text-slate-400">-- MB</td> -->
                        <td class="px-6 py-4">
                            <span
                                class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-emerald-500/10 text-emerald-400 border border-emerald-500/20">
                                <span class="material-icons-round text-xs mr-1">check</span>
                                Ready
                            </span>
                        </td>
                        <td class="px-6 py-4 text-right">
                            <a href="{% url 'summary' upload.id %}"
                                class="px-4 py-1.5 rounded-lg bg-primary/20 hover:bg-primary text-primary hover:text-white border border-primary/30 hover:border-primary transition-all text-xs font-semibold inline-block">
                                View
                            </a>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5" class="px-6 py-10 text-center text-slate-500">
                            <div class="flex flex-col items-center">
                                <span class="material-icons-round text-4xl mb-2 opacity-50">toc</span>
                                <p>No uploads yet. <a href="{% url 'upload' %}"
                                        class="text-primary hover:underline">Upload your first PPT</a></p>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Pagination (Static for now) -->
        {% if uploads.has_other_pages %}
        <div class="px-6 py-4 border-t border-white/5 bg-white/5 flex items-center justify-between">
            <span class="text-xs text-slate-400">Showing recent uploads</span>
            <!-- Add pagination logic here if needed later -->
        </div>
        {% endif %}
    </div>
</section>

<!-- Quick Stats (Bonus) -->
<section class="grid grid-cols-1 md:grid-cols-2 gap-6 pb-8">
    <div class="glass-panel p-6 rounded-2xl relative overflow-hidden group">
        <div class="absolute right-0 top-0 w-32 h-32 bg-orange-500/10 rounded-full blur-3xl -mr-10 -mt-10"></div>
        <h3 class="text-white font-semibold mb-4 relative z-10 flex items-center gap-2">
            <span class="material-icons-round text-orange-400">local_fire_department</span>
            Learning Streak
        </h3>
        <div class="flex items-end space-x-2 relative z-10">
            <span class="text-4xl font-bold text-white">{{ streak }}</span>
            <span class="text-sm text-slate-400 mb-1.5">days in a row</span>
        </div>

        <!-- 7-day visualizer -->
        <div class="mt-6 flex justify-between items-center relative z-10 max-w-xs">
            {% for i in "1234567" %}
            <div class="flex flex-col items-center gap-1">
                <div class="w-2 h-2 rounded-full {% if forloop.counter <= streak|default:0|slice:" :7" %}bg-orange-500
                    shadow-[0_0_8px_rgba(249,115,22,0.6)]{% else %}bg-white/10{% endif %}"></div>
            </div>
            {% endfor %}
        </div>
    </div>
    <div class="glass-panel p-6 rounded-2xl relative overflow-hidden flex items-center justify-between group">
        <div>
            <h3 class="text-white font-semibold flex items-center gap-2">
                <span class="material-icons-round text-primary">school</span>
                Vocabulary Mastered
            </h3>
            <p class="text-sm text-slate-400 mt-2">{{ quiz_count }} quizzes taken</p>
            <div class="mt-2 text-xs px-2 py-1 rounded bg-white/5 inline-block text-slate-300">
                {{ xp }} XP Earned
            </div>
        </div>
        <div class="w-20 h-20 relative flex items-center justify-center">
            <svg class="w-full h-full transform -rotate-90" viewbox="0 0 36 36">
                <path class="text-white/10"
                    d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none"
                    stroke="currentColor" stroke-width="3.5"></path>
                <path class="text-primary transition-all duration-1000 ease-out"
                    d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none"
                    stroke="currentColor" stroke-dasharray="{{ vocab_mastery }}, 100" stroke-width="3.5"></path>
            </svg>
            <span class="absolute text-sm font-bold text-white">{{ vocab_mastery }}%</span>
        </div>
    </div>
</section>
{% endblock %}